3 - ç”¨æˆ·æ¨¡å—

é¦–å…ˆå¼€å‘æ¯ä¸ªé¡¹ç›®åŸºæœ¬éƒ½å…·æœ‰çš„ç”¨æˆ·æ¨¡å—ï¼Œæœ¬èŠ‚æ•™ç¨‹å¯ä»¥å½“åšä¸€ä¸ª ç”¨æˆ·ç®¡ç†ç³»ç»Ÿé¡¹ç›® ç‹¬ç«‹å­¦ä¹ ï¼Œé€‚åˆæ–°æ‰‹å…¥é—¨ï¼Œåç«¯å’Œå‰ç«¯éƒ¨åˆ†ä¹Ÿå¯ä»¥æŒ‰éœ€ç‹¬ç«‹å­¦ä¹ ã€‚

æœ¬èŠ‚å¤§çº²ï¼š

éœ€æ±‚åˆ†æ
æ–¹æ¡ˆè®¾è®¡
åç«¯å¼€å‘
å‰ç«¯å¼€å‘
ä¸€ã€éœ€æ±‚åˆ†æ
å¯¹äºç”¨æˆ·æ¨¡å—ï¼Œé€šå¸¸è¦å…·æœ‰ä¸‹åˆ—åŠŸèƒ½ï¼š


- ç”¨æˆ·æ³¨å†Œ
- ç”¨æˆ·ç™»å½•
-è·å–å½“å‰ç™»å½•ç”¨æˆ·
- ç”¨æˆ·æ³¨é”€
- ç”¨æˆ·æƒé™æ§åˆ¶
-ã€ç®¡ç†å‘˜ã€‘ç®¡ç†ç”¨æˆ·
+ å…·ä½“åˆ†ææ¯ä¸ªéœ€æ±‚ï¼š

1ï¼‰ç”¨æˆ·æ³¨å†Œï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥è´¦å·ã€å¯†ç ã€ç¡®è®¤å¯†ç è¿›è¡Œæ³¨å†Œ

2ï¼‰ç”¨æˆ·ç™»å½•ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥è´¦å·å’Œå¯†ç ç™»å½•

3ï¼‰è·å–å½“å‰ç™»å½•ç”¨æˆ·ï¼šå¾—åˆ°å½“å‰å·²ç»ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸ç”¨é‡å¤ç™»å½•ï¼‰

4ï¼‰ç”¨æˆ·æ³¨é”€ï¼šç”¨æˆ·å¯ä»¥é€€å‡ºç™»å½•

5ï¼‰ç”¨æˆ·æƒé™æ§åˆ¶ï¼šç”¨æˆ·åˆåˆ†ä¸ºæ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜æ‹¥æœ‰æ•´ä¸ªç³»ç»Ÿçš„æœ€é«˜æƒé™ï¼Œæ¯”å¦‚å¯ä»¥ç®¡ç†å…¶ä»–ç”¨æˆ·

6ï¼‰ç”¨æˆ·ç®¡ç†ï¼šä»…ç®¡ç†å‘˜å¯ç”¨ï¼Œå¯ä»¥å¯¹æ•´ä¸ªç³»ç»Ÿä¸­çš„ç”¨æˆ·è¿›è¡Œç®¡ç†ï¼Œæ¯”å¦‚æœç´¢ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·

äºŒã€æ–¹æ¡ˆè®¾è®¡
å®ç°ç”¨æˆ·æ¨¡å—çš„éš¾åº¦ä¸å¤§ï¼Œæ–¹æ¡ˆè®¾è®¡é˜¶æ®µæˆ‘ä»¬éœ€è¦ç¡®è®¤ï¼š

åº“è¡¨è®¾è®¡
ç”¨æˆ·ç™»å½•æµç¨‹
å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ
åº“è¡¨è®¾è®¡
åº“åï¼šsy_picture

è¡¨åï¼šuserï¼ˆç”¨æˆ·è¡¨ï¼‰



1ã€æ ¸å¿ƒè®¾è®¡
ç”¨æˆ·è¡¨çš„æ ¸å¿ƒæ˜¯ç”¨æˆ·ç™»å½•å‡­è¯ï¼ˆè´¦å·å¯†ç ï¼‰å’Œä¸ªäººä¿¡æ¯ï¼ŒSQL å¦‚ä¸‹ï¼š

-- ç”¨æˆ·è¡¨
```
create table if not exists user
(
id           bigint auto_increment comment 'id' primary key,
userAccount  varchar(256)                           not null comment 'è´¦å·',
userPassword varchar(512)                           not null comment 'å¯†ç ',
userName     varchar(256)                           null comment 'ç”¨æˆ·æ˜µç§°',
userAvatar   varchar(1024)                          null comment 'ç”¨æˆ·å¤´åƒ',
userProfile  varchar(512)                           null comment 'ç”¨æˆ·ç®€ä»‹',
userRole     varchar(256) default 'user'            not null comment 'ç”¨æˆ·è§’è‰²ï¼šuser/admin',
editTime     datetime     default CURRENT_TIMESTAMP not null comment 'ç¼–è¾‘æ—¶é—´',
createTime   datetime     default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
updateTime   datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
isDelete     tinyint      default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
UNIQUE KEY uk_userAccount (userAccount),
INDEX idx_userName (userName)
) comment 'ç”¨æˆ·' collate = utf8mb4_unicode_ci;
```
å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š

1ï¼‰editTime å’Œ updateTime çš„åŒºåˆ«ï¼šeditTime è¡¨ç¤ºç”¨æˆ·ç¼–è¾‘ä¸ªäººä¿¡æ¯çš„æ—¶é—´ï¼ˆéœ€è¦ä¸šåŠ¡ä»£ç æ¥æ›´æ–°ï¼‰ï¼Œè€Œ updateTime è¡¨ç¤ºè¿™æ¡ç”¨æˆ·è®°å½•ä»»ä½•å­—æ®µå‘ç”Ÿä¿®æ”¹çš„æ—¶é—´ï¼ˆç”±æ•°æ®åº“è‡ªåŠ¨æ›´æ–°ï¼‰ã€‚

2ï¼‰ç»™å”¯ä¸€å€¼æ·»åŠ å”¯ä¸€é”®ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ï¼Œæ¯”å¦‚è´¦å· userAccountï¼Œåˆ©ç”¨æ•°æ®åº“å¤©ç„¶é˜²é‡å¤ï¼ŒåŒæ—¶å¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ã€‚aczEIt0s6acSJD0b30DJIz166bCvHHFZaNdKsO3bChY=

3ï¼‰ç»™ç»å¸¸ç”¨äºæŸ¥è¯¢çš„å­—æ®µæ·»åŠ ç´¢å¼•ï¼Œæ¯”å¦‚ç”¨æˆ·æ˜µç§° userNameï¼Œå¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ã€‚

ğŸ’¡ å»ºè®®å…»æˆå¥½ä¹ æƒ¯ï¼Œå°†åº“è¡¨è®¾è®¡ SQL ä¿å­˜åˆ°é¡¹ç›®çš„ç›®å½•ä¸­ï¼Œæ¯”å¦‚æ–°å»º sql/create_table.sql æ–‡ä»¶ï¼Œè¿™æ ·å…¶ä»–å¼€å‘è€…å°±èƒ½æ›´å¿«åœ°äº†è§£é¡¹ç›®ã€‚

2ã€æ‰©å±•è®¾è®¡
1ï¼‰å¦‚æœè¦å®ç°ä¼šå‘˜åŠŸèƒ½ï¼Œå¯ä»¥å¯¹è¡¨è¿›è¡Œå¦‚ä¸‹æ‰©å±•ï¼š

ç»™ userRole å­—æ®µæ–°å¢æšä¸¾å€¼ vipï¼Œè¡¨ç¤ºä¼šå‘˜ç”¨æˆ·ï¼Œå¯æ ¹æ®è¯¥å€¼åˆ¤æ–­ç”¨æˆ·æƒé™
æ–°å¢ä¼šå‘˜è¿‡æœŸæ—¶é—´å­—æ®µï¼Œå¯ç”¨äºè®°å½•ä¼šå‘˜æœ‰æ•ˆæœŸ
æ–°å¢ä¼šå‘˜å…‘æ¢ç å­—æ®µï¼Œå¯ç”¨äºè®°å½•ä¼šå‘˜çš„å¼€é€šæ–¹å¼
æ–°å¢ä¼šå‘˜ç¼–å·å­—æ®µï¼Œå¯ä¾¿äºå®šä½ç”¨æˆ·å¹¶æä¾›é¢å¤–æœåŠ¡ï¼Œå¹¶å¢åŠ ä¼šå‘˜å½’å±æ„Ÿ
å¯¹åº”çš„ SQL å¦‚ä¸‹ï¼š
```
vipExpireTime datetime     null comment 'ä¼šå‘˜è¿‡æœŸæ—¶é—´',
vipCode       varchar(128) null comment 'ä¼šå‘˜å…‘æ¢ç ',
vipNumber     bigint       null comment 'ä¼šå‘˜ç¼–å·'
```
2ï¼‰å¦‚æœè¦å®ç°ç”¨æˆ·é‚€è¯·åŠŸèƒ½ï¼Œå¯ä»¥å¯¹è¡¨è¿›è¡Œå¦‚ä¸‹æ‰©å±•ï¼š

æ–°å¢ shareCode åˆ†äº«ç å­—æ®µï¼Œç”¨äºè®°å½•æ¯ä¸ªç”¨æˆ·çš„å”¯ä¸€é‚€è¯·æ ‡è¯†ï¼Œå¯æ‹¼æ¥åˆ°é‚€è¯·ç½‘å€åé¢ï¼Œæ¯”å¦‚ https://mianshiya.com/?shareCode=xxx
æ–°å¢ inviteUser å­—æ®µï¼Œç”¨äºè®°å½•è¯¥ç”¨æˆ·è¢«å“ªä¸ªç”¨æˆ·é‚€è¯·äº†ï¼Œå¯é€šè¿‡è¿™ä¸ªå­—æ®µæŸ¥è¯¢æŸç”¨æˆ·é‚€è¯·çš„ç”¨æˆ·åˆ—è¡¨ã€‚
å¯¹åº”çš„ SQL å¦‚ä¸‹ï¼š

shareCode     varchar(20)  DEFAULT NULL COMMENT 'åˆ†äº«ç ',
inviteUser    bigint       DEFAULT NULL COMMENT 'é‚€è¯·ç”¨æˆ· id'
ç”¨æˆ·ç™»å½•æµç¨‹
1ï¼‰å»ºç«‹åˆå§‹ä¼šè¯ï¼šå‰ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼ŒæœåŠ¡å™¨ä¼šä¸ºè¯¥å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªåˆå§‹çš„åŒ¿å Sessionï¼Œå¹¶å°†å…¶çŠ¶æ€ä¿å­˜ä¸‹æ¥ã€‚è¿™ä¸ª Session çš„ ID ä¼šä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œè¿”å›ç»™å‰ç«¯ã€‚

2ï¼‰ç™»å½•æˆåŠŸï¼Œæ›´æ–°ä¼šè¯ä¿¡æ¯ï¼šå½“ç”¨æˆ·åœ¨å‰ç«¯è¾“å…¥æ­£ç¡®çš„è´¦å·å¯†ç å¹¶æäº¤åˆ°åç«¯éªŒè¯æˆåŠŸåï¼Œåç«¯ä¼šæ›´æ–°è¯¥ç”¨æˆ·çš„ Sessionï¼Œå°†ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ· IDã€ç”¨æˆ·åç­‰ï¼‰ä¿å­˜åˆ°ä¸è¯¥ Session å…³è”çš„å­˜å‚¨ä¸­ã€‚åŒæ—¶ï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ª Set-Cookie çš„å“åº”å¤´ï¼ŒæŒ‡ç¤ºå‰ç«¯ä¿å­˜è¯¥ç”¨æˆ·çš„ Session IDã€‚

3ï¼‰å‰ç«¯ä¿å­˜ Cookieï¼šå‰ç«¯æ¥æ”¶åˆ°åç«¯çš„å“åº”åï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ ¹æ® Set-Cookie æŒ‡ä»¤ï¼Œå°† Session ID å­˜å‚¨åˆ°æµè§ˆå™¨çš„ Cookie ä¸­ï¼Œä¸è¯¥åŸŸåç»‘å®šã€‚tgB/UQhU1b7uMjFsSpVmymOGdL3gv5vVuSFRkYDZ7co=

4ï¼‰å¸¦ Cookie çš„åç»­è¯·æ±‚ï¼šå½“å‰ç«¯å†æ¬¡å‘ç›¸åŒåŸŸåçš„æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚å¤´ä¸­é™„å¸¦ä¹‹å‰ä¿å­˜çš„ Cookieï¼Œå…¶ä¸­åŒ…å« Session IDã€‚

5ï¼‰åç«¯éªŒè¯ä¼šè¯ï¼šæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä»è¯·æ±‚å¤´ä¸­æå– Session IDï¼Œæ‰¾åˆ°å¯¹åº”çš„ Session æ•°æ®ã€‚

6ï¼‰è·å–ä¼šè¯ä¸­å­˜å‚¨çš„ä¿¡æ¯ï¼šåç«¯é€šè¿‡è¯¥ Session è·å–ä¹‹å‰å­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚ç™»å½•åã€æƒé™ç­‰ï¼‰ï¼Œä»è€Œè¯†åˆ«ç”¨æˆ·èº«ä»½å¹¶æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚VXI+7mSULu9nyEG7rdi9KV1WKFjZjEpc+bJXf9ezeOA=

afd3837a80c36e49d17bfb04f6a7cb21.png
å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ
å¯ä»¥å°†æ¥å£åˆ†ä¸º 4 ç§æƒé™ï¼š

æœªç™»å½•ä¹Ÿå¯ä»¥ä½¿ç”¨
ç™»å½•ç”¨æˆ·æ‰èƒ½ä½¿ç”¨
æœªç™»å½•ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ç™»å½•ç”¨æˆ·èƒ½è¿›è¡Œæ›´å¤šæ“ä½œï¼ˆæ¯”å¦‚ç™»å½•åæŸ¥çœ‹å…¨æ–‡ï¼‰
ä»…ç®¡ç†å‘˜æ‰èƒ½ä½¿ç”¨
ä¼ ç»Ÿçš„æƒé™æ§åˆ¶æ–¹æ³•æ˜¯ï¼Œåœ¨æ¯ä¸ªæ¥å£å†…å•ç‹¬ç¼–å†™é€»è¾‘ï¼šå…ˆè·å–åˆ°å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶ååˆ¤æ–­ç”¨æˆ·çš„æƒé™æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚

è¿™ç§æ–¹æ³•æœ€çµæ´»ï¼Œä½†æ˜¯ä¼šå†™å¾ˆå¤šé‡å¤çš„ä»£ç ï¼Œè€Œä¸”å…¶ä»–å¼€å‘è€…æ— æ³•ä¸€çœ¼å¾—çŸ¥æ¥å£æ‰€éœ€è¦çš„æƒé™ã€‚BY5FOXxw9OIVdo/I6bslNE0aR9QPpyFzlN4DV18d6aA=

æƒé™æ ¡éªŒå…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸€èˆ¬ä¼šé€šè¿‡ **Spring AOP åˆ‡é¢ + è‡ªå®šä¹‰æƒé™æ ¡éªŒæ³¨è§£ **å®ç°ç»Ÿä¸€çš„æ¥å£æ‹¦æˆªå’Œæƒé™æ ¡éªŒï¼›å¦‚æœæœ‰ç‰¹æ®Šçš„æƒé™æ ¡éªŒé€»è¾‘ï¼Œå†å•ç‹¬åœ¨æ¥å£ä¸­ç¼–ç ã€‚

ğŸ’¡ å¦‚æœéœ€è¦æ›´å¤æ‚æ›´çµæ´»çš„æƒé™æ§åˆ¶ï¼Œå¯ä»¥å¼•å…¥ Shiro / Spring Security / Sa-Token ç­‰ä¸“é—¨çš„æƒé™ç®¡ç†æ¡†æ¶ã€‚


OKï¼Œæœ‰äº†å®ç°æ–¹æ¡ˆåï¼Œæˆ‘ä»¬å…ˆæ¥å¼€å‘åç«¯æ¥å£ã€‚

ä¸‰ã€åç«¯å¼€å‘
ä»¥åæ¯æ¬¡å¼€å‘æ¥å£æ—¶ï¼Œéƒ½å¯ä»¥éµå¾ªä»¥ä¸‹æµç¨‹ã€‚

æ•°æ®è®¿é—®å±‚ä»£ç ç”Ÿæˆ
é¦–å…ˆåˆ©ç”¨ IDEA è¿æ¥ MySQL æ•°æ®åº“ï¼š


æ‰§è¡Œ SQL è„šæœ¬ï¼Œåˆ›å»ºæ•°æ®åº“è¡¨ï¼š


æ•°æ®è®¿é—®å±‚çš„ä»£ç ä¸€èˆ¬åŒ…æ‹¬å®ä½“ç±»ã€MyBatis çš„ Mapper ç±»å’Œ XML ç­‰ã€‚æ¯”èµ·æ‰‹åŠ¨ç¼–å†™ï¼Œå»ºè®®ä½¿ç”¨ MyBatisX ä»£ç ç”Ÿæˆæ’ä»¶ï¼Œå¯ä»¥å¿«é€Ÿå¾—åˆ°è¿™äº›æ–‡ä»¶ã€‚q8tzHPwYtfaShGB2mh/xPVoVGQGjpfAb9jJ7SVZ7uLg=

é€‰ä¸­æ•°æ®åº“çš„è¡¨ï¼Œå³é”®é€‰æ‹© MybatisX ç”Ÿæˆå™¨ï¼š


æŒ‰ç…§ä¸‹å›¾è¿›è¡Œé…ç½®ï¼š


å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„ä»£ç ï¼ŒåŒ…æ‹¬å®ä½“ç±»ã€Mapperã€Serviceï¼š

æˆ‘ä»¬éœ€è¦å°†è¿™äº›ä»£ç ç§»åŠ¨åˆ°é¡¹ç›®å¯¹åº”çš„ä½ç½®ï¼Œæ¯”å¦‚å°† Mapper ç§»åŠ¨åˆ° mapper åŒ…ã€User ç§»åŠ¨åˆ° com.example.sypicturebackend.model.entity åŒ…ã€Service ç§»åŠ¨åˆ° service åŒ…ã€‚è®°å¾—å°†æœ‰ç”¨çš„æ–‡ä»¶æ·»åŠ åˆ° Git è¿›è¡Œæ‰˜ç®¡ã€‚

ç§»åŠ¨ä¹‹åï¼Œæ³¨æ„ä¿®æ”¹ UserMapper.xml ç­‰æ–‡ä»¶çš„åŒ…åï¼š


æ•°æ®æ¨¡å‹å¼€å‘
1ã€å®ä½“ç±»
ç”Ÿæˆçš„ä»£ç ä¹Ÿè®¸ä¸èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ï¼Œæ¯”å¦‚æ•°æ®åº“å®ä½“ç±»ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ›´æ”¹å…¶å­—æ®µé…ç½®ï¼ŒæŒ‡å®šä¸»é”®ç­–ç•¥å’Œé€»è¾‘åˆ é™¤ã€‚

id é»˜è®¤æ˜¯è¿ç»­ç”Ÿæˆçš„ï¼Œå®¹æ˜“è¢«çˆ¬è™«æŠ“å–ï¼Œæ‰€ä»¥æ›´æ¢ç­–ç•¥ä¸º ASSIGN_ID é›ªèŠ±ç®—æ³•ç”Ÿæˆã€‚
æ•°æ®åˆ é™¤æ—¶é»˜è®¤ä¸ºå½»åº•åˆ é™¤è®°å½•ï¼Œå¦‚æœå‡ºç°è¯¯åˆ ï¼Œå°†éš¾ä»¥æ¢å¤ï¼Œæ‰€ä»¥é‡‡ç”¨é€»è¾‘åˆ é™¤ â€”â€” é€šè¿‡ä¿®æ”¹ isDelete å­—æ®µä¸º 1 è¡¨ç¤ºå·²å¤±æ•ˆçš„æ•°æ®ã€‚
ä¿®æ”¹çš„ä»£ç å¦‚ä¸‹ï¼š
```
@TableName(value ="user")
@Data
public class User implements Serializable {
/**
* idï¼ˆè¦æŒ‡å®šä¸»é”®ç­–ç•¥ï¼‰
*/
@TableId(type = IdType.ASSIGN_ID)
private Long id;

    // ...
    
    /**
     * æ˜¯å¦åˆ é™¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰
     */
    @TableLogic
    private Integer isDelete;
}
```
ä½¿ç”¨æ¡†æ¶çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä»»ä½•ç–‘é—®ï¼Œéƒ½å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£æŸ¥é˜…ï¼Œæ¯”å¦‚äº†è§£ MyBatis Plus çš„ä¸»é”®ç”Ÿæˆæ³¨è§£ï¼šhttps://baomidou.com/reference/annotation/#tableid

2ã€æšä¸¾ç±»
å¯¹äºç”¨æˆ·è§’è‰²è¿™æ ·å€¼çš„æ•°é‡æœ‰é™çš„ã€å¯æšä¸¾çš„å­—æ®µï¼Œæœ€å¥½å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œä¾¿äºåœ¨é¡¹ç›®ä¸­è·å–å€¼ã€å‡å°‘æšä¸¾å€¼è¾“å…¥é”™è¯¯çš„æƒ…å†µã€‚

åœ¨ com.example.sypicturebackend.model.enums åŒ…ä¸‹æ–°å»º UserRoleEnumï¼š
```
@Getter
public enum UserRoleEnum {

    USER("ç”¨æˆ·", "user"),
    ADMIN("ç®¡ç†å‘˜", "admin");

    private final String text;

    private final String value;

    UserRoleEnum(String text, String value) {
        this.text = text;
        this.value = value;
    }

    /**
     * æ ¹æ® value è·å–æšä¸¾
     *
     * @param value æšä¸¾å€¼çš„value
     * @return æšä¸¾å€¼
     */
    public static UserRoleEnum getEnumByValue(String value) {
        if (ObjUtil.isEmpty(value)) {
            return null;
        }
        for (UserRoleEnum anEnum : UserRoleEnum.values()) {
            if (anEnum.value.equals(value)) {
                return anEnum;
            }
        }
        return null;
    }
}
```
å…¶ä¸­ï¼ŒgetEnumByValue æ˜¯é€šè¿‡ value æ‰¾åˆ°å…·ä½“çš„æšä¸¾å¯¹è±¡ã€‚

ğŸ’¡ å¦‚æœæšä¸¾å€¼ç‰¹åˆ«å¤šï¼Œå¯ä»¥ Map ç¼“å­˜æ‰€æœ‰æšä¸¾å€¼æ¥åŠ é€ŸæŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯éå†åˆ—è¡¨ã€‚

ä¸‹é¢ä¾æ¬¡è¿›è¡Œå„åŠŸèƒ½æ¥å£çš„å¼€å‘ã€‚

ç”¨æˆ·æ³¨å†Œ
1ã€æ•°æ®æ¨¡å‹
åœ¨ com.example.sypicturebackend.model.dto.user ä¸‹æ–°å»ºç”¨äºæ¥å—è¯·æ±‚å‚æ•°çš„ç±»ï¼š
```
@Data
public class UserRegisterRequest implements Serializable {

    private static final long serialVersionUID = 3191241716373120793L;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * å¯†ç 
     */
    private String userPassword;

    /**
     * ç¡®è®¤å¯†ç 
     */
    private String checkPassword;
}
```
ğŸ’¡ åœ¨ Java æ¥å£å¼€å‘ä¸­ï¼Œä¸ºæ¯ä¸ªæ¥å£å®šä¹‰ä¸€ä¸ªä¸“é—¨çš„ç±»æ¥æ¥æ”¶è¯·æ±‚å‚æ•°ï¼Œå¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ï¼Œä¾¿äºå¯¹å‚æ•°è¿›è¡Œç»Ÿä¸€éªŒè¯å’Œæ‰©å±•ï¼ŒåŒæ—¶å‡å°‘æ¥å£æ–¹æ³•å‚æ•°è¿‡å¤šå¯¼è‡´çš„å¤æ‚æ€§ï¼Œæœ‰åŠ©äºåœ¨å¤æ‚åœºæ™¯ä¸‹æ›´æ¸…æ™°åœ°ç®¡ç†å’Œä¼ é€’æ•°æ®ã€‚ziI4mrNZHbTGODbM5WBXomg/En7jOK0nLmnL0HvsJyc=

2ã€æœåŠ¡å¼€å‘
åœ¨ service åŒ…çš„ UserService ä¸­å¢åŠ æ–¹æ³•å£°æ˜ï¼š
```
/**
* ç”¨æˆ·æ³¨å†Œ
*
* @param userAccount   ç”¨æˆ·è´¦æˆ·
* @param userPassword  ç”¨æˆ·å¯†ç 
* @param checkPassword æ ¡éªŒå¯†ç 
* @return æ–°ç”¨æˆ· id
  */
  long userRegister(String userAccount, String userPassword, String checkPassword);
  åœ¨ UserServiceImpl ä¸­å¢åŠ å®ç°ä»£ç ï¼Œæ³¨æ„å¤šè¡¥å……ä¸€äº›æ ¡éªŒæ¡ä»¶ï¼š

@Override
public long userRegister(String userAccount, String userPassword, String checkPassword) {
// 1. æ ¡éªŒ
if (StrUtil.hasBlank(userAccount, userPassword, checkPassword)) {
throw new BusinessException(ErrorCode.PARAMS_ERROR, "å‚æ•°ä¸ºç©º");
}
if (userAccount.length() < 4) {
throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·è´¦å·è¿‡çŸ­");
}
if (userPassword.length() < 8 || checkPassword.length() < 8) {
throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·å¯†ç è¿‡çŸ­");
}
if (!userPassword.equals(checkPassword)) {
throw new BusinessException(ErrorCode.PARAMS_ERROR, "ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´");
}
// 2. æ£€æŸ¥æ˜¯å¦é‡å¤
QueryWrapper<User> queryWrapper = new QueryWrapper<>();
queryWrapper.eq("userAccount", userAccount);
long count = this.baseMapper.selectCount(queryWrapper);
if (count > 0) {
throw new BusinessException(ErrorCode.PARAMS_ERROR, "è´¦å·é‡å¤");
}
// 3. åŠ å¯†
String encryptPassword = getEncryptPassword(userPassword);
// 4. æ’å…¥æ•°æ®
User user = new User();
user.setUserAccount(userAccount);
user.setUserPassword(encryptPassword);
user.setUserName("æ— å");
user.setUserRole(UserRoleEnum.USER.getValue());
boolean saveResult = this.save(user);
if (!saveResult) {
throw new BusinessException(ErrorCode.SYSTEM_ERROR, "æ³¨å†Œå¤±è´¥ï¼Œæ•°æ®åº“é”™è¯¯");
}
return user.getId();
}
```
æ³¨æ„ï¼Œä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†ç”¨æˆ·å¯†ç åŠ å¯†åè¿›è¡Œå­˜å‚¨ã€‚å¯ä»¥å°è£…ä¸€ä¸ªæ–¹æ³•ï¼Œä¾¿äºåç»­å¤ç”¨ï¼špB71S6ZZhJolJH9oa51hQkFB6ESolTsDFHNiKQ05xNo=
```
@Override
public String getEncryptPassword(String userPassword) {
// ç›å€¼ï¼Œæ··æ·†å¯†ç 
final String SALT = "sy";
return DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());
}
3ã€æ¥å£å¼€å‘
åœ¨ controller åŒ…ä¸­æ–°å»º UserControllerï¼Œæ–°å¢ç”¨æˆ·æ³¨å†Œæ¥å£ï¼šziI4mrNZHbTGODbM5WBXomg/En7jOK0nLmnL0HvsJyc=

@RestController
@RequestMapping("/user")
public class UserController {

    @Resource
    private UserService userService;

    /**
     * ç”¨æˆ·æ³¨å†Œ
     */
    @PostMapping("/register")
    public BaseResponse<Long> userRegister(@RequestBody UserRegisterRequest userRegisterRequest) {
        ThrowUtils.throwIf(userRegisterRequest == null, ErrorCode.PARAMS_ERROR);
        String userAccount = userRegisterRequest.getUserAccount();
        String userPassword = userRegisterRequest.getUserPassword();
        String checkPassword = userRegisterRequest.getCheckPassword();
        long result = userService.userRegister(userAccount, userPassword, checkPassword);
        return ResultUtils.success(result);
    }
}
```
4ã€æµ‹è¯•
æ¯å¼€å‘å®Œä¸€ä¸ªæ¥å£ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ Swagger æ¥å£æ–‡æ¡£æ¥æµ‹è¯•ï¼š

ğŸ’¡ æµ‹è¯•æ—¶è¦å°¤å…¶æ³¨æ„è¾¹ç•Œå€¼å’Œç‰¹æ®Šå€¼ï¼Œä¸èƒ½åªæµ‹è¯•æ­£å¸¸çš„æƒ…å†µã€‚

ç”¨æˆ·ç™»å½•
1ã€æ•°æ®æ¨¡å‹
åœ¨ com.example.sypicturebackend.model.dto.user ä¸‹æ–°å»ºç”¨äºæ¥å—è¯·æ±‚å‚æ•°çš„ç±»ï¼š
```
@Data
public class UserLoginRequest implements Serializable {

    private static final long serialVersionUID = 3191241716373120793L;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * å¯†ç 
     */
    private String userPassword;
}
```
2ã€æœåŠ¡å¼€å‘
åœ¨ service åŒ…çš„ UserService ä¸­å¢åŠ æ–¹æ³•å£°æ˜ï¼š
```
/**
* ç”¨æˆ·ç™»å½•
*
* @param userAccount  ç”¨æˆ·è´¦æˆ·
* @param userPassword ç”¨æˆ·å¯†ç 
* @param request
* @return è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯
  */
  LoginUserVO userLogin(String userAccount, String userPassword, HttpServletRequest request);
  åœ¨ UserServiceImpl ä¸­å¢åŠ å®ç°ä»£ç ï¼Œæ³¨æ„å¤šè¡¥å……ä¸€äº›æ ¡éªŒæ¡ä»¶ï¼Œåœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨å½“å‰çš„ Session ä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š

@Override
public LoginUserVO userLogin(String userAccount, String userPassword, HttpServletRequest request) {
// 1. æ ¡éªŒ
if (StrUtil.hasBlank(userAccount, userPassword)) {
throw new BusinessException(ErrorCode.PARAMS_ERROR, "å‚æ•°ä¸ºç©º");
}
if (userAccount.length() < 4) {
throw new BusinessException(ErrorCode.PARAMS_ERROR, "è´¦å·é”™è¯¯");
}
if (userPassword.length() < 8) {
throw new BusinessException(ErrorCode.PARAMS_ERROR, "å¯†ç é”™è¯¯");
}
// 2. åŠ å¯†
String encryptPassword = getEncryptPassword(userPassword);
// æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨
QueryWrapper<User> queryWrapper = new QueryWrapper<>();
queryWrapper.eq("userAccount", userAccount);
queryWrapper.eq("userPassword", encryptPassword);
User user = this.baseMapper.selectOne(queryWrapper);
// ç”¨æˆ·ä¸å­˜åœ¨
if (user == null) {
log.info("user login failed, userAccount cannot match userPassword");
throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·ä¸å­˜åœ¨æˆ–å¯†ç é”™è¯¯");
}
// 3. è®°å½•ç”¨æˆ·çš„ç™»å½•æ€
request.getSession().setAttribute(USER_LOGIN_STATE, user);
return this.getLoginUserVO(user);
}
```
æ³¨æ„ï¼Œç”±äºæ³¨å†Œç”¨æˆ·æ—¶å­˜å…¥æ•°æ®åº“çš„å¯†ç æ˜¯åŠ å¯†åçš„ï¼ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œä¹Ÿè¦å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡ŒåŒæ ·ç®—æ³•çš„åŠ å¯†ï¼Œæ‰èƒ½è·Ÿæ•°æ®åº“çš„ä¿¡æ¯å¯¹åº”ä¸Šã€‚

å¯ä»¥æŠŠä¸Šè¿°çš„ Session ç†è§£ä¸ºä¸€ä¸ª Mapï¼Œå¯ä»¥ç»™ Map è®¾ç½® key å’Œ valueï¼Œæ¯ä¸ªä¸åŒçš„ SessionID å¯¹åº”çš„ Session å­˜å‚¨éƒ½æ˜¯ä¸åŒçš„ï¼Œä¸ç”¨æ‹…å¿ƒä¼šæ±¡æŸ“ã€‚æ‰€ä»¥ä¸Šè¿°ä»£ç ä¸­ï¼Œç»™ Session è®¾ç½®äº†å›ºå®šçš„ keyï¼ˆUSER_LOGIN_STATEï¼‰ï¼Œå¯ä»¥å°†è¿™ä¸ª key å€¼æå–ä¸ºå¸¸é‡ï¼Œä¾¿äºåç»­è·å–ã€‚

åœ¨ constant åŒ…ä¸‹æ–°å»º UserConstant ç±»ï¼Œç»Ÿä¸€å£°æ˜ç”¨æˆ·ç›¸å…³çš„å¸¸é‡ï¼š
```
public interface UserConstant {

    /**
     * ç”¨æˆ·ç™»å½•æ€é”®
     */
    String USER_LOGIN_STATE = "user_login";

    //  region æƒé™

    /**
     * é»˜è®¤è§’è‰²
     */
    String DEFAULT_ROLE = "user";

    /**
     * ç®¡ç†å‘˜è§’è‰²
     */
    String ADMIN_ROLE = "admin";
    
    // endregion
}
```
3ã€æ¥å£å¼€å‘
åœ¨ UserController ä¸­æ–°å¢ç”¨æˆ·ç™»å½•æ¥å£ï¼š
```
@PostMapping("/login")
public BaseResponse<LoginUserVO> userLogin(@RequestBody UserLoginRequest userLoginRequest, HttpServletRequest request) {
ThrowUtils.throwIf(userLoginRequest == null, ErrorCode.PARAMS_ERROR);
String userAccount = userLoginRequest.getUserAccount();
String userPassword = userLoginRequest.getUserPassword();
LoginUserVO loginUserVO = userService.userLogin(userAccount, userPassword, request);
return ResultUtils.success(loginUserVO);
}
```
è·å–å½“å‰ç™»å½•ç”¨æˆ·
å¯ä»¥ä» request è¯·æ±‚å¯¹è±¡å¯¹åº”çš„ Session ä¸­ç›´æ¥è·å–åˆ°ä¹‹å‰ä¿å­˜çš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œæ— éœ€å…¶ä»–è¯·æ±‚å‚æ•°ã€‚

1ã€æœåŠ¡å¼€å‘
åœ¨ service åŒ…çš„ UserService ä¸­å¢åŠ æ–¹æ³•å£°æ˜ï¼š
```
/**
* è·å–å½“å‰ç™»å½•ç”¨æˆ·
*
* @param request
* @return
  */
  User getLoginUser(HttpServletRequest request);
  åœ¨ UserServiceImpl ä¸­å¢åŠ å®ç°ä»£ç ï¼Œæ­¤å¤„ä¸ºäº†ä¿è¯è·å–åˆ°çš„æ•°æ®å§‹ç»ˆæ˜¯æœ€æ–°çš„ï¼Œå…ˆä» Session ä¸­è·å–ç™»å½•ç”¨æˆ·çš„ idï¼Œç„¶åä»æ•°æ®åº“ä¸­æŸ¥è¯¢æœ€æ–°çš„ç»“æœã€‚ä»£ç å¦‚ä¸‹ï¼šT3OYtQAAUU7tcPywhIOi0/qjaWuzx8+bR5TKCG1wPa4=

@Override
public User getLoginUser(HttpServletRequest request) {
// å…ˆåˆ¤æ–­æ˜¯å¦å·²ç™»å½•
Object userObj = request.getSession().getAttribute(USER_LOGIN_STATE);
User currentUser = (User) userObj;
if (currentUser == null || currentUser.getId() == null) {
throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);
}
// ä»æ•°æ®åº“æŸ¥è¯¢ï¼ˆè¿½æ±‚æ€§èƒ½çš„è¯å¯ä»¥æ³¨é‡Šï¼Œç›´æ¥è¿”å›ä¸Šè¿°ç»“æœï¼‰
long userId = currentUser.getId();
currentUser = this.getById(userId);
if (currentUser == null) {
throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);
}
return currentUser;
}
```
2ã€æ¥å£å¼€å‘
åœ¨ UserController ä¸­æ–°å¢è·å–å½“å‰ç™»å½•ç”¨æˆ·æ¥å£ï¼šq8tzHPwYtfaShGB2mh/xPVoVGQGjpfAb9jJ7SVZ7uLg=

```
@GetMapping("/get/login")
public BaseResponse<LoginUserVO> getLoginUser(HttpServletRequest request) {
User loginUser = userService.getLoginUser(request);
return ResultUtils.success(userService.getLoginUserVO(loginUser));
}
```
æ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ˜¯ç›´æ¥å°†æ•°æ®åº“æŸ¥åˆ°çš„æ‰€æœ‰ä¿¡æ¯éƒ½è¿”å›ç»™äº†å‰ç«¯ï¼ˆåŒ…æ‹¬å¯†ç ï¼‰ï¼Œå¯èƒ½å­˜åœ¨ä¿¡æ¯æ³„éœ²çš„å®‰å…¨é£é™©ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹è¿”å›ç»“æœè¿›è¡Œè„±æ•å¤„ç†ã€‚

3ã€æ•°æ®è„±æ•
åœ¨ com.example.sypicturebackend.model.vo åŒ…ä¸‹æ–°å»º LoginUserVO ç±»ï¼Œè¡¨ç¤ºè„±æ•åçš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼š
```
@Data
public class LoginUserVO implements Serializable {

    /**
     * ç”¨æˆ· id
     */
    private Long id;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç”¨æˆ·ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin
     */
    private String userRole;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private Date createTime;

    /**
     * æ›´æ–°æ—¶é—´
     */
    private Date updateTime;

    private static final long serialVersionUID = 1L;
}
```
åœ¨ UserService ä¸­æ–°å¢è·å–è„±æ•åçš„å·²ç™»å½•ç”¨æˆ·ä¿¡æ¯æ–¹æ³•ï¼š

/**
* è·å–è„±æ•çš„å·²ç™»å½•ç”¨æˆ·ä¿¡æ¯
*
* @return
  */
  LoginUserVO getLoginUserVO(User user);
  ç¼–å†™æ–¹æ³•å¯¹åº”çš„å®ç°ç±»ï¼Œå…¶å®å°±æ˜¯å°† User ç±»çš„å±æ€§å¤åˆ¶åˆ° LoginUserVO ä¸­ï¼Œä¸å­˜åœ¨çš„å­—æ®µå°±è¢«è¿‡æ»¤æ‰äº†ï¼š
```
@Override
public LoginUserVO getLoginUserVO(User user) {
if (user == null) {
return null;
}
LoginUserVO loginUserVO = new LoginUserVO();
BeanUtils.copyProperties(user, loginUserVO);
return loginUserVO;
}
```
ä¿®æ”¹ Controller çš„ getLoginUser æ¥å£ï¼Œæ”¹ä¸ºè¿”å›è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯ï¼š
```
@GetMapping("/get/login")
public BaseResponse<LoginUserVO> getLoginUser(HttpServletRequest request) {
User user = userService.getLoginUser(request);
return ResultUtils.success(userService.getLoginUserVO(user));
}
```
ç”¨æˆ·æ³¨é”€
å¯ä»¥ä» request è¯·æ±‚å¯¹è±¡å¯¹åº”çš„ Session ä¸­ç›´æ¥è·å–åˆ°ä¹‹å‰ä¿å­˜çš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œæ¥å®Œæˆæ³¨é”€ï¼Œæ— éœ€å…¶ä»–è¯·æ±‚å‚æ•°ã€‚

1ã€æœåŠ¡å¼€å‘
åœ¨ service åŒ…çš„ UserService ä¸­å¢åŠ æ–¹æ³•å£°æ˜ï¼šziI4mrNZHbTGODbM5WBXomg/En7jOK0nLmnL0HvsJyc=
```
/**
* ç”¨æˆ·æ³¨é”€
*
* @param request
* @return
  */
  boolean userLogout(HttpServletRequest request);
  åœ¨ UserServiceImpl ä¸­å¢åŠ å®ç°ä»£ç ï¼Œä» Session ä¸­ç§»é™¤æ‰å½“å‰ç”¨æˆ·çš„ç™»å½•æ€å³å¯ï¼š

@Override
public boolean userLogout(HttpServletRequest request) {
// å…ˆåˆ¤æ–­æ˜¯å¦å·²ç™»å½•
Object userObj = request.getSession().getAttribute(USER_LOGIN_STATE);
if (userObj == null) {
throw new BusinessException(ErrorCode.OPERATION_ERROR, "æœªç™»å½•");
}
// ç§»é™¤ç™»å½•æ€
request.getSession().removeAttribute(USER_LOGIN_STATE);
return true;
}
```
2ã€æ¥å£å¼€å‘
åœ¨ UserController ä¸­æ–°å¢ç”¨æˆ·æ³¨é”€æ¥å£ï¼š
```
@PostMapping("/logout")
public BaseResponse<Boolean> userLogout(HttpServletRequest request) {
ThrowUtils.throwIf(request == null, ErrorCode.PARAMS_ERROR);
boolean result = userService.userLogout(request);
return ResultUtils.success(result);
}
```
ç”¨æˆ·æƒé™æ§åˆ¶
åœ¨æœ¬èŠ‚æ•™ç¨‹çš„æ–¹æ¡ˆè®¾è®¡ä¸­è®²åˆ°ï¼šæƒé™æ ¡éªŒå…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸€èˆ¬ä¼šé€šè¿‡ **Spring AOP åˆ‡é¢ + è‡ªå®šä¹‰æƒé™æ ¡éªŒæ³¨è§£ **å®ç°ç»Ÿä¸€çš„æ¥å£æ‹¦æˆªå’Œæƒé™æ ¡éªŒï¼›å¦‚æœæœ‰ç‰¹æ®Šçš„æƒé™æ ¡éªŒé€»è¾‘ï¼Œå†å•ç‹¬åœ¨æ¥å£ä¸­ç¼–ç ã€‚

1ã€æƒé™æ ¡éªŒæ³¨è§£
é¦–å…ˆç¼–å†™æƒé™æ ¡éªŒæ³¨è§£ï¼Œæ”¾åˆ° annotation åŒ…ä¸‹ï¼š
```
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface AuthCheck {

    /**
     * å¿…é¡»æœ‰æŸä¸ªè§’è‰²
     */
    String mustRole() default "";
}
```
2ã€æƒé™æ ¡éªŒåˆ‡é¢
ç¼–å†™æƒé™æ ¡éªŒ AOPï¼Œé‡‡ç”¨ç¯ç»•é€šçŸ¥ï¼Œåœ¨ **æ‰“ä¸Šè¯¥æ³¨è§£çš„æ–¹æ³• **æ‰§è¡Œå‰åè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œæ¯”å¦‚æ ¡éªŒæƒé™ã€‚

ä»£ç å¦‚ä¸‹ï¼Œæ”¾åˆ° aop åŒ…ä¸‹ï¼š
```
@Aspect
@Component
public class AuthInterceptor {

    @Resource
    private UserService userService;

    /**
     * æ‰§è¡Œæ‹¦æˆª
     *
     * @param joinPoint åˆ‡å…¥ç‚¹
     * @param authCheck æƒé™æ ¡éªŒæ³¨è§£
     */
    @Around("@annotation(authCheck)")
    public Object doInterceptor(ProceedingJoinPoint joinPoint, AuthCheck authCheck) throws Throwable {
        String mustRole = authCheck.mustRole();
        RequestAttributes requestAttributes = RequestContextHolder.currentRequestAttributes();
        HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();
        // å½“å‰ç™»å½•ç”¨æˆ·
        User loginUser = userService.getLoginUser(request);
        UserRoleEnum mustRoleEnum = UserRoleEnum.getEnumByValue(mustRole);
        // ä¸éœ€è¦æƒé™ï¼Œæ”¾è¡Œ
        if (mustRoleEnum == null) {
            return joinPoint.proceed();
        }
        // ä»¥ä¸‹ä¸ºï¼šå¿…é¡»æœ‰è¯¥æƒé™æ‰é€šè¿‡
        // è·å–å½“å‰ç”¨æˆ·å…·æœ‰çš„æƒé™
        UserRoleEnum userRoleEnum = UserRoleEnum.getEnumByValue(loginUser.getUserRole());
        // æ²¡æœ‰æƒé™ï¼Œæ‹’ç»
        if (userRoleEnum == null) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
        // è¦æ±‚å¿…é¡»æœ‰ç®¡ç†å‘˜æƒé™ï¼Œä½†ç”¨æˆ·æ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼Œæ‹’ç»
        if (UserRoleEnum.ADMIN.equals(mustRoleEnum) && !UserRoleEnum.ADMIN.equals(userRoleEnum)) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
        // é€šè¿‡æƒé™æ ¡éªŒï¼Œæ”¾è¡Œ
        return joinPoint.proceed();
    }
}
```
3ã€ä½¿ç”¨æ³¨è§£
åªè¦ç»™æ–¹æ³•æ·»åŠ äº† @AuthCheck æ³¨è§£ï¼Œå°±å¿…é¡»è¦ç™»å½•ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

å¯ä»¥è®¾ç½® mustRole ä¸ºç®¡ç†å‘˜ï¼Œè¿™æ ·ä»…ç®¡ç†å‘˜æ‰èƒ½ä½¿ç”¨è¯¥æ¥å£ï¼špB71S6ZZhJolJH9oa51hQkFB6ESolTsDFHNiKQ05xNo=

@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
å¯¹äºä¸éœ€è¦ç™»å½•å°±èƒ½ä½¿ç”¨çš„æ¥å£ï¼Œä¸éœ€è¦ä½¿ç”¨è¯¥æ³¨è§£ã€‚

ç”¨æˆ·ç®¡ç†
ç”¨æˆ·ç®¡ç†åŠŸèƒ½å…·ä½“å¯ä»¥æ‹†åˆ†ä¸ºï¼š

ã€ç®¡ç†å‘˜ã€‘åˆ›å»ºç”¨æˆ·
ã€ç®¡ç†å‘˜ã€‘æ ¹æ® id åˆ é™¤ç”¨æˆ·
ã€ç®¡ç†å‘˜ã€‘æ›´æ–°ç”¨æˆ·
ã€ç®¡ç†å‘˜ã€‘åˆ†é¡µè·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆéœ€è¦è„±æ•ï¼‰
ã€ç®¡ç†å‘˜ã€‘æ ¹æ® id è·å–ç”¨æˆ·ï¼ˆæœªè„±æ•ï¼‰
æ ¹æ® id è·å–ç”¨æˆ·ï¼ˆè„±æ•ï¼‰
1ã€æ•°æ®æ¨¡å‹
1ï¼‰æ¯ä¸ªæ“ä½œéƒ½éœ€è¦æä¾›ä¸€ä¸ªè¯·æ±‚ç±»ï¼Œéƒ½æ”¾åœ¨ dto.user åŒ…ä¸‹ã€‚


ç”¨æˆ·åˆ›å»ºè¯·æ±‚ï¼š
```
@Data
public class UserAddRequest implements Serializable {

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç”¨æˆ·ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²: user, admin
     */
    private String userRole;

    private static final long serialVersionUID = 1L;
}
ç”¨æˆ·æ›´æ–°è¯·æ±‚ï¼š

@Data
public class UserUpdateRequest implements Serializable {

    /**
     * id
     */
    private Long id;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin
     */
    private String userRole;

    private static final long serialVersionUID = 1L;
}
ç”¨æˆ·æŸ¥è¯¢è¯·æ±‚ï¼Œéœ€è¦ç»§æ‰¿å…¬å…±åŒ…ä¸­çš„ PageRequest æ¥æ”¯æŒåˆ†é¡µæŸ¥è¯¢ï¼š

@EqualsAndHashCode(callSuper = true)
@Data
public class UserQueryRequest extends PageRequest implements Serializable {

    /**
     * id
     */
    private Long id;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin/ban
     */
    private String userRole;

    private static final long serialVersionUID = 1L;
}
```
2ï¼‰ç”±äºè¦æä¾›è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£ï¼Œéœ€è¦å’Œè·å–å½“å‰ç™»å½•ç”¨æˆ·æ¥å£ä¸€æ ·å¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡Œè„±æ•ã€‚VXI+7mSULu9nyEG7rdi9KV1WKFjZjEpc+bJXf9ezeOA=

åœ¨ com.example.sypicturebackend.model.vo åŒ…ä¸‹æ–°å»º UserVOï¼Œè¡¨ç¤ºè„±æ•åçš„ç”¨æˆ·ï¼š
```
@Data
public class UserVO implements Serializable {

    /**
     * id
     */
    private Long id;
    
    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç”¨æˆ·ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin
     */
    private String userRole;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private Date createTime;

    private static final long serialVersionUID = 1L;
}
2ã€æœåŠ¡å¼€å‘
1ï¼‰åœ¨ UserService ä¸­ç¼–å†™è·å–è„±æ•åçš„å•ä¸ªç”¨æˆ·ä¿¡æ¯ã€è·å–è„±æ•åçš„ç”¨æˆ·åˆ—è¡¨æ–¹æ³•ï¼š

@Override
public UserVO getUserVO(User user) {
if (user == null) {
return null;
}
UserVO userVO = new UserVO();
BeanUtils.copyProperties(user, userVO);
return userVO;
}

@Override
public List<UserVO> getUserVOList(List<User> userList) {
if (CollUtil.isEmpty(userList)) {
return new ArrayList<>();
}
return userList.stream().map(this::getUserVO).collect(Collectors.toList());
}
```
2ï¼‰é™¤äº†ä¸Šè¿°æ–¹æ³•å¤–ï¼Œå¯¹äºåˆ†é¡µæŸ¥è¯¢æ¥å£ï¼Œéœ€è¦æ ¹æ®ç”¨æˆ·ä¼ å…¥çš„å‚æ•°æ¥æ„é€  SQL æŸ¥è¯¢ã€‚ç”±äºä½¿ç”¨ MyBatis Plus æ¡†æ¶ï¼Œä¸ç”¨è‡ªå·±æ‹¼æ¥ SQL äº†ï¼Œè€Œæ˜¯é€šè¿‡æ„é€  QueryWrapper å¯¹è±¡æ¥ç”Ÿæˆ SQL æŸ¥è¯¢ã€‚PhHskc7Zmbe7quvmcErZHf3lXbbedWfP4my2BX2FaQQ=

å¯ä»¥åœ¨ UserService ä¸­ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œä¸“é—¨ç”¨äºå°†æŸ¥è¯¢è¯·æ±‚è½¬ä¸º QueryWrapper å¯¹è±¡ï¼š
```
@Override
public QueryWrapper<User> getQueryWrapper(UserQueryRequest userQueryRequest) {
if (userQueryRequest == null) {
throw new BusinessException(ErrorCode.PARAMS_ERROR, "è¯·æ±‚å‚æ•°ä¸ºç©º");
}
Long id = userQueryRequest.getId();
String userAccount = userQueryRequest.getUserAccount();
String userName = userQueryRequest.getUserName();
String userProfile = userQueryRequest.getUserProfile();
String userRole = userQueryRequest.getUserRole();
String sortField = userQueryRequest.getSortField();
String sortOrder = userQueryRequest.getSortOrder();
QueryWrapper<User> queryWrapper = new QueryWrapper<>();
queryWrapper.eq(ObjUtil.isNotNull(id), "id", id);
queryWrapper.eq(StrUtil.isNotBlank(userRole), "userRole", userRole);
queryWrapper.like(StrUtil.isNotBlank(userAccount), "userAccount", userAccount);
queryWrapper.like(StrUtil.isNotBlank(userName), "userName", userName);
queryWrapper.like(StrUtil.isNotBlank(userProfile), "userProfile", userProfile);
queryWrapper.orderBy(StrUtil.isNotEmpty(sortField), sortOrder.equals("ascend"), sortField);
return queryWrapper;
}
```
3ã€æ¥å£å¼€å‘
ä¸Šè¿°åŠŸèƒ½å…¶å®éƒ½æ˜¯æ ·æ¿ä»£ç ï¼Œä¿—ç§° â€œå¢åˆ æ”¹æŸ¥â€ã€‚

ä»£ç å®ç°æ¯”è¾ƒç®€å•ï¼Œæ³¨æ„æ·»åŠ å¯¹åº”çš„æƒé™æ³¨è§£ã€åšå¥½å‚æ•°æ ¡éªŒå³å¯ï¼š
```
/**
* åˆ›å»ºç”¨æˆ·
  */
  @PostMapping("/add")
  @AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
  public BaseResponse<Long> addUser(@RequestBody UserAddRequest userAddRequest) {
  ThrowUtils.throwIf(userAddRequest == null, ErrorCode.PARAMS_ERROR);
  User user = new User();
  BeanUtils.copyProperties(userAddRequest, user);
  // é»˜è®¤å¯†ç  12345678
  final String DEFAULT_PASSWORD = "12345678";
  String encryptPassword = userService.getEncryptPassword(DEFAULT_PASSWORD);
  user.setUserPassword(encryptPassword);
  boolean result = userService.save(user);
  ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
  return ResultUtils.success(user.getId());
  }

/**
* æ ¹æ® id è·å–ç”¨æˆ·ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
  */
  @GetMapping("/get")
  @AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
  public BaseResponse<User> getUserById(long id) {
  ThrowUtils.throwIf(id <= 0, ErrorCode.PARAMS_ERROR);
  User user = userService.getById(id);
  ThrowUtils.throwIf(user == null, ErrorCode.NOT_FOUND_ERROR);
  return ResultUtils.success(user);
  }

/**
* æ ¹æ® id è·å–åŒ…è£…ç±»
  */
  @GetMapping("/get/vo")
  public BaseResponse<UserVO> getUserVOById(long id) {
  BaseResponse<User> response = getUserById(id);
  User user = response.getData();
  return ResultUtils.success(userService.getUserVO(user));
  }

/**
* åˆ é™¤ç”¨æˆ·
  */
  @PostMapping("/delete")
  @AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
  public BaseResponse<Boolean> deleteUser(@RequestBody DeleteRequest deleteRequest) {
  if (deleteRequest == null || deleteRequest.getId() <= 0) {
  throw new BusinessException(ErrorCode.PARAMS_ERROR);
  }
  boolean b = userService.removeById(deleteRequest.getId());
  return ResultUtils.success(b);
  }

/**
* æ›´æ–°ç”¨æˆ·
  */
  @PostMapping("/update")
  @AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
  public BaseResponse<Boolean> updateUser(@RequestBody UserUpdateRequest userUpdateRequest) {
  if (userUpdateRequest == null || userUpdateRequest.getId() == null) {
  throw new BusinessException(ErrorCode.PARAMS_ERROR);
  }
  User user = new User();
  BeanUtils.copyProperties(userUpdateRequest, user);
  boolean result = userService.updateById(user);
  ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
  return ResultUtils.success(true);
  }

/**
* åˆ†é¡µè·å–ç”¨æˆ·å°è£…åˆ—è¡¨ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
*
* @param userQueryRequest æŸ¥è¯¢è¯·æ±‚å‚æ•°
  */
  @PostMapping("/list/page/vo")
  @AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
  public BaseResponse<Page<UserVO>> listUserVOByPage(@RequestBody UserQueryRequest userQueryRequest) {
  ThrowUtils.throwIf(userQueryRequest == null, ErrorCode.PARAMS_ERROR);
  long current = userQueryRequest.getCurrent();
  long pageSize = userQueryRequest.getPageSize();
  Page<User> userPage = userService.page(new Page<>(current, pageSize),
  userService.getQueryWrapper(userQueryRequest));
  Page<UserVO> userVOPage = new Page<>(current, pageSize, userPage.getTotal());
  List<UserVO> userVOList = userService.getUserVOList(userPage.getRecords());
  userVOPage.setRecords(userVOList);
  return ResultUtils.success(userVOPage);
  }
  ```
  ğŸ’¡ æœ‰åŒå­¦å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼šä¸æ˜¯è¯´ä¸è¦åœ¨ Controller ä¸­å†™ä¸šåŠ¡é€»è¾‘ä»£ç ä¹ˆï¼Ÿ

æˆ‘çš„å»ºè®®æ˜¯å¼€å‘æ—¶è¦çµæ´»ä¸€äº›ï¼Œæˆ‘ä»¬è¦ä¿è¯ Controller çš„ç²¾ç®€æ²¡é”™ï¼Œä½†ä¸ä»£è¡¨ä»€ä¹ˆä»£ç éƒ½ä¸åœ¨ Controller é‡Œå†™ã€‚å¯¹äºæˆ‘ä»¬ä¸Šè¿°çš„ä»£ç ï¼Œæ ¹æœ¬å°±æ²¡æœ‰å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœéè¦æŠ½ä¸€å±‚ Service æ–¹æ³•ä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œä½†ä¼šæ›´éº»çƒ¦ä¸€äº›ã€‚

4ã€åˆ†é¡µåŠŸèƒ½ä¿®å¤
ä½¿ç”¨ Swagger æ¥å£æ–‡æ¡£ä¾æ¬¡å¯¹ä¸Šè¿°æ¥å£è¿›è¡Œæµ‹è¯•ï¼Œå‘ç° listUserVOByPage æ¥å£æœ‰ä¸€äº›é—®é¢˜ï¼

åˆ†é¡µå¥½åƒæ²¡æœ‰ç”Ÿæ•ˆï¼Œè¿˜æ˜¯æŸ¥å‡ºäº†å…¨éƒ¨æ•°æ®ï¼š


ç”±äºæˆ‘ä»¬ç”¨çš„æ˜¯ MyBatis Plus æ¥æ“ä½œæ•°æ®åº“ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ å®˜æ–¹æ–‡æ¡£ æ¥æŸ¥è¯¢è§£å†³æ–¹æ¡ˆã€‚

æŸ¥é˜…åå‘ç°ï¼ŒåŸæ¥å¿…é¡»è¦é…ç½®ä¸€ä¸ªåˆ†é¡µæ’ä»¶ã€‚å¿…é¡»è¦æ³¨æ„ï¼Œæœ¬é¡¹ç›®ä½¿ç”¨çš„ v3.5.9 ç‰ˆæœ¬å¼•å…¥åˆ†é¡µæ’ä»¶çš„æ–¹å¼å’Œä¹‹å‰ä¸åŒï¼v3.5.9 ç‰ˆæœ¬åéœ€è¦ç‹¬ç«‹å®‰è£…åˆ†é¡µæ’ä»¶ä¾èµ–ï¼ï¼ï¼


åœ¨ pom.xml ä¸­å¼•å…¥åˆ†é¡µæ’ä»¶ä¾èµ–ï¼š
```
<!-- MyBatis Plus åˆ†é¡µæ’ä»¶ -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-jsqlparser-4.9</artifactId>
</dependency>
```
å…‰å¼•å…¥è¿™ä¸€æ¡ï¼Œå¤§æ¦‚ç‡æ˜¯æ— æ³•æˆåŠŸä¸‹è½½ä¾èµ–çš„ï¼Œè¿˜è¦åœ¨ pom.xml çš„ä¾èµ–ç®¡ç†é…ç½®ä¸­è¡¥å…… mybatis-plus-bomï¼šT3OYtQAAUU7tcPywhIOi0/qjaWuzx8+bR5TKCG1wPa4=
```
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>${spring-boot.version}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-bom</artifactId>
            <version>3.5.9</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```
ä¾èµ–ä¸‹è½½æˆåŠŸåï¼Œåœ¨ config åŒ…ä¸‹æ–°å»º MyBatis Plus æ‹¦æˆªå™¨é…ç½®ï¼Œæ·»åŠ åˆ†é¡µæ’ä»¶ï¼š
```
@Configuration
@MapperScan("com.sy.sycturebackend.mapper")
public class MyBatisPlusConfig {

    /**
     * æ‹¦æˆªå™¨é…ç½®
     *
     * @return {@link MybatisPlusInterceptor}
     */
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        // åˆ†é¡µæ’ä»¶
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
        return interceptor;
    }
}
```
é‡å¯é¡¹ç›®ï¼Œè¿™æ¬¡å°±èƒ½æ­£å¸¸å®Œæˆåˆ†é¡µäº†~

5ã€æ•°æ®ç²¾åº¦ä¿®å¤
ä½†æ˜¯ï¼Œåœ¨æµ‹è¯•ä¸­ï¼Œå¦‚æœä½ æ‰“å¼€ F12 æ§åˆ¶å°ï¼Œåˆ©ç”¨é¢„è§ˆæ¥æŸ¥çœ‹å“åº”æ•°æ®ï¼Œå°±ä¼šå‘ç°å¦ä¸€ä¸ªé—®é¢˜ï¼šid çš„æœ€åä¸¤ä½å¥½åƒéƒ½å˜æˆ 0 äº†ï¼T3OYtQAAUU7tcPywhIOi0/qjaWuzx8+bR5TKCG1wPa4=


ä½†æ˜¯åœ¨å“åº”ä¸­ã€ä»¥åŠ Swagger ä¸­æŸ¥çœ‹ï¼Œå´æ˜¯æ­£å¸¸çš„ï¼š


è¿™æ˜¯ç”±äºå‰ç«¯ JS çš„ç²¾åº¦èŒƒå›´æœ‰é™ï¼Œæˆ‘ä»¬åç«¯è¿”å›çš„ id èŒƒå›´è¿‡å¤§ï¼Œå¯¼è‡´å‰ç«¯ç²¾åº¦ä¸¢å¤±ï¼Œä¼šå½±å“å‰ç«¯é¡µé¢è·å–åˆ°çš„æ•°æ®ç»“æœã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨åç«¯ config åŒ…ä¸‹æ–°å»ºä¸€ä¸ªå…¨å±€ JSON é…ç½®ï¼Œå°†æ•´ä¸ªåç«¯ Spring MVC æ¥å£è¿”å›å€¼çš„é•¿æ•´å‹æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œè¿”å›ï¼Œä»è€Œé›†ä¸­è§£å†³é—®é¢˜ã€‚
```
/**
* Spring MVC Json é…ç½®
  */
  @JsonComponent
  public class JsonConfig {

  /**
    * æ·»åŠ  Long è½¬ json ç²¾åº¦ä¸¢å¤±çš„é…ç½®
      */
      @Bean
      public ObjectMapper jacksonObjectMapper(Jackson2ObjectMapperBuilder builder) {
      ObjectMapper objectMapper = builder.createXmlMapper(false).build();
      SimpleModule module = new SimpleModule();
      module.addSerializer(Long.class, ToStringSerializer.instance);
      module.addSerializer(Long.TYPE, ToStringSerializer.instance);
      objectMapper.registerModule(module);
      return objectMapper;
      }
      }
      é‡å¯é¡¹ç›®è¿›è¡Œæµ‹è¯•ï¼Œè¿™æ¬¡çœ‹åˆ°çš„ id å€¼å°±æ­£å¸¸äº†ï¼š
```

